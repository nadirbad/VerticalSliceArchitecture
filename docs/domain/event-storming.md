# EventStorming Workshop Results

This document shows the results of an EventStorming session for the Healthcare Clinic domain. We used [EventStorming](https://www.eventstorming.com/) by Alberto Brandolini to discover domain events, commands, aggregates, and bounded contexts.

> "It's developers (mis)understanding, not expert knowledge that gets released in production." â€” Alberto Brandolini

## Sticky Note Legend

| Concept | Color | Description |
|---------|-------|-------------|
| **Domain Event** | ğŸŸ§ Orange | Something significant that happened (past tense) |
| **Command** | ğŸŸ¦ Blue | Request to perform an action |
| **Aggregate** | ğŸŸ¨ Yellow | Cluster of business rules handling commands |
| **Policy** | ğŸŸª Lilac | Automation: "Whenever X happens, do Y" |
| **Read Model** | ğŸŸ© Green | Data needed for user decisions |
| **Actor** | ğŸ‘¤ | Human role issuing commands |
| **External System** | ğŸŸ« Pink | External systems we interact with |
| **Hot Spot** | ğŸ”´ Red | Questions, risks, problems to resolve |

---

## Big Picture EventStorming

### Step 1: Domain Events (Chaotic Brainstorm)

We started by asking: *"What significant things happen in our clinic?"*

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CHAOTIC EVENT GENERATION                               â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ§ Appointment       ğŸŸ§ Prescription      ğŸŸ§ Refill           ğŸŸ§ Patient     â”‚
â”‚      Booked               Issued               Approved            Registered  â”‚
â”‚                                                                                â”‚
â”‚        ğŸŸ§ Appointment     ğŸŸ§ Refill          ğŸŸ§ Appointment    ğŸŸ§ Doctor       â”‚
â”‚           Rescheduled        Requested          Cancelled         Registered  â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ§ Appointment       ğŸŸ§ Refill            ğŸŸ§ Reminder                        â”‚
â”‚      Completed            Denied               Sent                            â”‚
â”‚                                                                                â”‚
â”‚   ğŸ”´ What about         ğŸ”´ Do we need       ğŸ”´ Who sends                       â”‚
â”‚      no-shows?             waiting list?       reminders?                      â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Timeline (Left to Right)

We sorted events chronologically, revealing two main flows:

```text
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

SCHEDULING FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ§ Appointmentâ”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Appointmentâ”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Appointmentâ”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Appointmentâ”‚
â”‚    Booked    â”‚    â”‚  Rescheduled â”‚    â”‚   Cancelled  â”‚    â”‚   Completed  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚
                           â–¼                   â–¼
                    (alternative)        (alternative)


MEDICATIONS FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ§ Prescriptionâ”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Refill    â”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Refill    â”‚
â”‚    Issued    â”‚    â”‚   Requested  â”‚    â”‚   Approved   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ ğŸŸ§ Refill    â”‚
                                        â”‚   Denied     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         (alternative)
```

### Step 3: Actors & External Systems

We identified who triggers each event:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ACTORS                          EXTERNAL SYSTEMS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ‘¤ Patient                      ğŸŸ« Email/SMS Service                       â”‚
â”‚     â€¢ Books appointments            â€¢ Sends confirmations                   â”‚
â”‚     â€¢ Reschedules                   â€¢ Sends reminders                       â”‚
â”‚     â€¢ Cancels                       â€¢ Sends refill notifications            â”‚
â”‚     â€¢ Requests refills                                                      â”‚
â”‚                                  ğŸŸ« Calendar System (future)                â”‚
â”‚  ğŸ‘¤ Doctor                          â€¢ Sync appointments                     â”‚
â”‚     â€¢ Completes appointments                                                â”‚
â”‚     â€¢ Issues prescriptions       ğŸŸ« Pharmacy System (future)                â”‚
â”‚     â€¢ Approves/denies refills       â€¢ Fulfills prescriptions                â”‚
â”‚                                                                             â”‚
â”‚  ğŸ‘¤ Receptionist (future)                                                   â”‚
â”‚     â€¢ Registers patients                                                    â”‚
â”‚     â€¢ Books on behalf of patients                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Pivotal Events & Bounded Contexts

We identified **pivotal events** - moments where responsibility shifts or actions become hard to undo:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PIVOTAL EVENTS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  âš¡ Appointment Booked                                                      â”‚
â”‚     â†’ Commitment made, doctor's time reserved                               â”‚
â”‚     â†’ Triggers: confirmation, calendar block                                â”‚
â”‚                                                                             â”‚
â”‚  âš¡ Appointment Completed                                                   â”‚
â”‚     â†’ Visit happened, cannot be undone                                      â”‚
â”‚     â†’ Unlocks: prescription issuance, billing                               â”‚
â”‚                                                                             â”‚
â”‚  âš¡ Prescription Issued                                                     â”‚
â”‚     â†’ Legal document created                                                â”‚
â”‚     â†’ Triggers: pharmacy notification, refill eligibility                   â”‚
â”‚                                                                             â”‚
â”‚  âš¡ Refill Approved                                                         â”‚
â”‚     â†’ Medication dispensed                                                  â”‚
â”‚     â†’ Decrements: refills remaining                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

From pivotal events, we drew context boundaries:

```text
           SCHEDULING                              MEDICATIONS
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                           â•‘          â•‘                           â•‘
    â•‘  ğŸŸ§ Appointment Booked    â•‘          â•‘  ğŸŸ§ Prescription Issued   â•‘
    â•‘  ğŸŸ§ Appointment Rescheduled          â•‘  ğŸŸ§ Refill Requested      â•‘
    â•‘  ğŸŸ§ Appointment Cancelled â•‘          â•‘  ğŸŸ§ Refill Approved       â•‘
    â•‘  ğŸŸ§ Appointment Completed â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  ğŸŸ§ Refill Denied         â•‘
    â•‘                           â•‘          â•‘                           â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 (triggers)
```

---

## Design Level EventStorming

After Big Picture, we zoomed into each bounded context for detailed modeling.

### Scheduling Context: Appointment Aggregate

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              APPOINTMENT AGGREGATE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Book        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  ğŸŸ¨ APPOINTMENT       â”‚ â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Appointment  â”‚â”€â”€â”€â–¶â”‚ ğŸŸ§ Appointmentâ”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚
â”‚  â”‚ Patient â”‚    â”‚                 â”‚    â”‚    Booked    â”‚  â”‚                       â”‚ â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  Invariants:          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚          â”‚  â€¢ Doctor cannot be   â”‚ â”‚
â”‚                        â–¼                      â”‚          â”‚    double-booked      â”‚ â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚          â”‚  â€¢ Duration 10m-8h    â”‚ â”‚
â”‚               â”‚ ğŸŸ© Doctor       â”‚             â”‚          â”‚  â€¢ Min 15min advance  â”‚ â”‚
â”‚               â”‚   Schedule      â”‚             â”‚          â”‚                       â”‚ â”‚
â”‚               â”‚   (availability)â”‚             â–¼          â”‚  Preconditions:       â”‚ â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â€¢ Patient exists     â”‚ â”‚
â”‚                                      â”‚ ğŸŸª Send      â”‚    â”‚  â€¢ Doctor exists      â”‚ â”‚
â”‚                                      â”‚   Confirmationâ”‚   â”‚  â€¢ Time slot free     â”‚ â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                       â”‚ â”‚
â”‚                                                          â”‚  Postconditions:      â”‚ â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â€¢ Status = Scheduled â”‚ â”‚
â”‚                                                          â”‚  â€¢ Event raised       â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                       â”‚ â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Reschedule  â”‚    â”‚ ğŸŸ§ Appointmentâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Appointment  â”‚â”€â”€â”€â–¶â”‚  Rescheduled â”‚                            â”‚
â”‚  â”‚ Patient â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                        â–¼                      â”‚          â”‚  BUSINESS RULES       â”‚ â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚               â”‚ ğŸŸ© Current      â”‚             â–¼          â”‚                       â”‚ â”‚
â”‚               â”‚   Appointment   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â€¢ 24h notice requiredâ”‚ â”‚
â”‚               â”‚   (start time)  â”‚    â”‚ ğŸŸª Notify    â”‚    â”‚  â€¢ New slot must be   â”‚ â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   Patient    â”‚    â”‚    available          â”‚ â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â€¢ Keep audit trail   â”‚ â”‚
â”‚                                                          â”‚                       â”‚ â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Cancel      â”‚    â”‚ ğŸŸ§ Appointmentâ”‚  ğŸ”´ HOT SPOT:             â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Appointment  â”‚â”€â”€â”€â–¶â”‚   Cancelled  â”‚     What about no-show    â”‚
â”‚  â”‚ Patient â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     fees? (out of scope)  â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                       â”‚
â”‚                                               RULE: Cannot cancel if completed     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Complete    â”‚    â”‚ ğŸŸ§ Appointmentâ”‚                            â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Appointment  â”‚â”€â”€â”€â–¶â”‚   Completed  â”‚                            â”‚
â”‚  â”‚ Doctor  â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚          RULE: Cannot complete     â”‚
â”‚                                               â–¼          if cancelled              â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                                      â”‚ ğŸŸª Enable    â”‚                              â”‚
â”‚                                      â”‚   Prescriptionâ”‚                             â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Medications Context: Prescription & RefillRequest Aggregates

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             PRESCRIPTION AGGREGATE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Issue       â”‚    â”‚ ğŸŸ§ Prescription  â”‚  ğŸŸ¨ PRESCRIPTION      â”‚ â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Prescription â”‚â”€â”€â”€â–¶â”‚    Issued    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚ Doctor  â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚ â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚  Invariants:          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚          â”‚  â€¢ MaxRefills â‰¤ 12    â”‚ â”‚
â”‚                        â–¼                      â”‚          â”‚  â€¢ ExpiresUtc > Now   â”‚ â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚          â”‚  â€¢ RefillsUsed â‰¤ Max  â”‚ â”‚
â”‚               â”‚ ğŸŸ© Patient Info â”‚             â”‚          â”‚                       â”‚ â”‚
â”‚               â”‚   (allergies,   â”‚             â–¼          â”‚  State:               â”‚ â”‚
â”‚               â”‚    history)     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â€¢ IssuedUtc          â”‚ â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ ğŸŸª Notify    â”‚    â”‚  â€¢ ExpiresUtc         â”‚ â”‚
â”‚                                      â”‚   Patient    â”‚    â”‚  â€¢ MaxRefills         â”‚ â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â€¢ RefillsUsed        â”‚ â”‚
â”‚                                                          â”‚                       â”‚ â”‚
â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            REFILL REQUEST AGGREGATE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Request     â”‚    â”‚ ğŸŸ§ Refill    â”‚  â”‚  ğŸŸ¨ REFILL REQUEST    â”‚ â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Refill       â”‚â”€â”€â”€â–¶â”‚   Requested  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚ Patient â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚ â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚  Invariants:          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚          â”‚  â€¢ One pending per Rx â”‚ â”‚
â”‚                        â–¼                      â”‚          â”‚                       â”‚ â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚          â”‚  State:               â”‚ â”‚
â”‚               â”‚ ğŸŸ© Prescription â”‚             â–¼          â”‚  â€¢ Status (Pending,   â”‚ â”‚
â”‚               â”‚   Details       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    Approved, Denied)  â”‚ â”‚
â”‚               â”‚   (refills left,â”‚    â”‚ ğŸŸª Notify    â”‚    â”‚  â€¢ RequestedUtc       â”‚ â”‚
â”‚               â”‚    expiration)  â”‚    â”‚   Doctor     â”‚    â”‚  â€¢ ProcessedUtc       â”‚ â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                       â”‚ â”‚
â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Approve     â”‚    â”‚ ğŸŸ§ Refill    â”‚                            â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Refill       â”‚â”€â”€â”€â–¶â”‚   Approved   â”‚                            â”‚
â”‚  â”‚ Doctor  â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚          SIDE EFFECT:              â”‚
â”‚                        â–¼                      â–¼          Prescription.RefillsUsed++â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚               â”‚ ğŸŸ© Refill       â”‚    â”‚ ğŸŸª Notify    â”‚                              â”‚
â”‚               â”‚   Request       â”‚    â”‚   Patient    â”‚                              â”‚
â”‚               â”‚   (status)      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚         â”‚    â”‚  ğŸŸ¦ Deny        â”‚    â”‚ ğŸŸ§ Refill    â”‚                            â”‚
â”‚  â”‚ ğŸ‘¤      â”‚â”€â”€â”€â–¶â”‚    Refill       â”‚â”€â”€â”€â–¶â”‚   Denied     â”‚  RULE: Must provide       â”‚
â”‚  â”‚ Doctor  â”‚    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  denial reason             â”‚
â”‚  â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â–¼                                    â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                                      â”‚ ğŸŸª Notify    â”‚                              â”‚
â”‚                                      â”‚   Patient    â”‚                              â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary: Commands, Events & Aggregates

### Implemented âœ…

| Command | Event | Aggregate | Status |
|---------|-------|-----------|--------|
| Book Appointment | AppointmentBooked | Appointment | âœ… Done |
| Reschedule Appointment | AppointmentRescheduled | Appointment | âœ… Done |
| Cancel Appointment | AppointmentCancelled | Appointment | âœ… Done |
| Complete Appointment | AppointmentCompleted | Appointment | âœ… Done |
| Issue Prescription | PrescriptionIssued | Prescription | âœ… Done |

### Planned ğŸ“‹

| Command | Event | Aggregate | Status |
|---------|-------|-----------|--------|
| Request Refill | RefillRequested | RefillRequest | ğŸ“‹ Phase 1 |
| Approve Refill | RefillApproved | RefillRequest | ğŸ“‹ Phase 1 |
| Deny Refill | RefillDenied | RefillRequest | ğŸ“‹ Phase 1 |
| Register Patient | PatientRegistered | Patient | ğŸ“‹ Phase 2 |
| Register Doctor | DoctorRegistered | Doctor | ğŸ“‹ Phase 2 |

---

## Hot Spots Identified

| Hot Spot | Decision | Status |
|----------|----------|--------|
| ğŸ”´ What about no-shows? | Out of scope for MVP | Deferred |
| ğŸ”´ Do we need a waiting list? | Out of scope for MVP | Deferred |
| ğŸ”´ Who sends reminders? | External notification service | Future |
| ğŸ”´ Multiple prescriptions per visit? | Yes, supported | Resolved |
| ğŸ”´ Prescription renewals vs refills? | Refills only for MVP | Resolved |

---

## Policies (Automation Rules)

| When... | Then... | Implemented |
|---------|---------|-------------|
| Appointment Booked | Send confirmation email | ğŸŸª Handler exists |
| Appointment Rescheduled | Notify patient of new time | ğŸŸª Handler exists |
| Prescription Issued | Notify patient | ğŸ“‹ Planned |
| Refill Requested | Notify prescribing doctor | ğŸ“‹ Planned |
| Refill Approved | Notify patient, update Rx | ğŸ“‹ Planned |
| Refill Denied | Notify patient with reason | ğŸ“‹ Planned |

---

## From EventStorming to Code

The EventStorming artifacts map directly to code:

| EventStorming | Code Location |
|---------------|---------------|
| ğŸŸ§ Domain Event | `src/Application/Domain/Healthcare/*Event.cs` |
| ğŸŸ¦ Command | `*Command` record in feature file |
| ğŸŸ¨ Aggregate | `src/Application/Domain/Healthcare/*.cs` |
| ğŸŸª Policy | `src/Application/Features/Healthcare/*/EventHandlers/` |
| ğŸ‘¤ Actor | Implied by endpoint (patient/doctor routes) |
| ğŸŸ© Read Model | `*Query` + `*Result` in feature file |

Example mapping for **Book Appointment**:

```text
EventStorming                          Code
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ Patient                          â†’  POST /api/healthcare/appointments
ğŸŸ¦ Book Appointment                 â†’  BookAppointmentCommand
ğŸŸ¨ Appointment (aggregate)          â†’  Appointment.Schedule(...)
ğŸŸ§ Appointment Booked               â†’  AppointmentBookedEvent
ğŸŸª Send Confirmation                â†’  AppointmentBookedEventHandler
```

---

## References

- [EventStorming](https://www.eventstorming.com/) - Alberto Brandolini
- [Introducing EventStorming](https://leanpub.com/introducing_eventstorming) - Book
- [EventStorming Glossary & Cheat Sheet](https://github.com/ddd-crew/eventstorming-glossary-cheat-sheet) - DDD Crew
